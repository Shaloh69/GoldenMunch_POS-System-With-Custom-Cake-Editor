# X11 Touchscreen Calibration Configuration
# For Raspberry Pi 5 + ILITEK Touchscreen
# Location: /etc/X11/xorg.conf.d/99-touchscreen-calibration.conf
#
# This file provides libinput-based touch calibration for ILITEK touchscreens
# on Raspberry Pi 5 running Bookworm with X11.
#
# Installation:
#   sudo cp config/99-touchscreen-calibration.conf /etc/X11/xorg.conf.d/
#   sudo reboot
#
# IMPORTANT: This configuration uses libinput matrices, NOT xinput.
# On Pi 5 + ILITEK, xinput transformations are ignored because libinput
# takes precedence in the input stack.

Section "InputClass"
    Identifier "ILITEK Touch Portrait Right"
    MatchProduct "ILITEK ILITEK-TP"
    MatchIsTouchscreen "on"
    Driver "libinput"
    # Portrait Right Rotation Matrix: 0° → 90° clockwise (portrait right)
    # This matrix rotates touch coordinates to match a screen rotated 90° right
    Option "CalibrationMatrix" "0 1 0 -1 0 1 0 0 1"
EndSection

# Alternative orientations (comment/uncomment as needed):

# Portrait Left (270° or -90°)
# Section "InputClass"
#     Identifier "ILITEK Touch Portrait Left"
#     MatchProduct "ILITEK ILITEK-TP"
#     MatchIsTouchscreen "on"
#     Driver "libinput"
#     Option "CalibrationMatrix" "0 -1 1 1 0 0 0 0 1"
# EndSection

# Landscape Inverted (180°)
# Section "InputClass"
#     Identifier "ILITEK Touch Landscape Inverted"
#     MatchProduct "ILITEK ILITEK-TP"
#     MatchIsTouchscreen "on"
#     Driver "libinput"
#     Option "CalibrationMatrix" "-1 0 1 0 -1 1 0 0 1"
# EndSection

# Normal Landscape (0°)
# Section "InputClass"
#     Identifier "ILITEK Touch Landscape"
#     MatchProduct "ILITEK ILITEK-TP"
#     MatchIsTouchscreen "on"
#     Driver "libinput"
#     Option "CalibrationMatrix" "1 0 0 0 1 0 0 0 1"
# EndSection

# Troubleshooting:
# 1. Verify your touchscreen device name:
#    libinput list-devices | grep -A 5 "ILITEK"
#
# 2. Check if config is loaded:
#    grep -r "ILITEK" /var/log/Xorg.0.log
#
# 3. Ensure screen rotation is set via xrandr (not this file):
#    xrandr --output HDMI-1 --rotate right
#
# 4. DO NOT use xinput commands for touch rotation on Pi 5 + ILITEK
#    They will be overridden by this libinput configuration
#
# 5. Matrix format explanation:
#    [a b c]   x_out = a*x_in + b*y_in + c
#    [d e f]   y_out = d*x_in + e*y_in + f
#    [0 0 1]   (homogeneous coordinates)
#
#    For portrait right (90° CW):
#    x_out = 0*x + 1*y + 0 = y
#    y_out = -1*x + 0*y + 1 = 1-x (inverted and offset)
